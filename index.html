<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Barcode Scanner</title>
    <script src="https://unpkg.com/@zxing/library@0.18.6/umd/index.min.js"></script>
</head>
<body>

<button id="start-button">Start Scanner</button>
<video id="video" width="300" height="200" style="border: 1px solid black"></video>

<h2 id="barcode-value" style="text-align:center;">Scanned Barcode Value: None</h2>

<script>
    const video = document.getElementById('video');
    const codeReader = new ZXing.BrowserMultiFormatReader();

    document.getElementById('start-button').addEventListener('click', () => {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then((stream) => {
                video.srcObject = stream;
                video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
                video.play();
                decodeContinuously(codeReader, video);
            })
            .catch((err) => {
                console.error(err);
            });
    });

    function decodeContinuously(codeReader, video) {
        codeReader.decodeFromVideoElementContinuously(video, (result, err) => {
            if (result) {
                console.log(result);
                document.getElementById('barcode-value').textContent = 'Scanned Barcode Value: ' + result.text;
                // Optional: stop scanning after the first successful scan
                video.srcObject.getTracks().forEach(track => track.stop());
            }

            if (err && !(err instanceof ZXing.NotFoundException)) {
                console.error(err);
                video.srcObject.getTracks().forEach(track => track.stop());
            }
        });
    }
</script>

</body>
</html>
